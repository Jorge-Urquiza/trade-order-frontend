import{A as a,B as n,Ba as he,C as u,Ca as Se,D as ne,E as y,F as m,Fa as Ce,G as de,H as pe,I as l,J as c,K as h,L as I,M as j,N as me,O as F,P as E,R as ce,S as ue,W as fe,X as ve,a as D,b as w,d as P,g as re,ga as ae,h as C,ha as O,i as N,ja as _,k as R,ka as ge,l as k,la as U,m as ie,ma as L,n as M,na as v,o as A,oa as $,p as V,pa as H,qa as q,ra as G,s as o,sa as z,ta as K,ua as ye,v as g,va as X,w as T,x as B,xa as Y,y as f,ya as be,z as s,za as Te}from"./chunk-6H2CTWIY.js";var xe={production:!0,apiBaseUrl:"https://demo-api.dev"};var J=class i{baseUrl=xe.apiBaseUrl.replace(/\/+$/,"");buildUrl(t){let e=t.replace(/^\/+/,"");return this.baseUrl?`${this.baseUrl}/${e}`:`/${e}`}static \u0275fac=function(e){return new(e||i)};static \u0275prov=R({token:i,factory:i.\u0275fac,providedIn:"root"})};var S=class i{constructor(t,e){this.http=t;this.endpoint=e.buildUrl("trade-orders")}endpoint;requestContext=new fe().set(Se,!0).set(Ce,!0);getTradeOrders(){return this.http.get(this.endpoint,{context:this.requestContext})}createTradeOrder(t){return this.http.post(this.endpoint,t,{context:this.requestContext})}updateTradeOrder(t,e){return this.http.put(`${this.endpoint}/${t}`,e,{context:this.requestContext})}deleteTradeOrder(t){return this.http.delete(`${this.endpoint}/${t}`,{context:this.requestContext})}static \u0275fac=function(e){return new(e||i)(ie(ve),ie(J))};static \u0275prov=R({token:i,factory:i.\u0275fac,providedIn:"root"})};var De=()=>({width:"100%"});function Ve(i,t){if(i&1&&(a(0,"small",17),l(1),n()),i&2){let e=m();o(),c(e.controlError("pair"))}}function Be(i,t){if(i&1&&(a(0,"small",17),l(1),n()),i&2){let e=m();o(),c(e.controlError("side"))}}function je(i,t){if(i&1&&(a(0,"small",17),l(1),n()),i&2){let e=m();o(),c(e.controlError("type"))}}function Fe(i,t){if(i&1&&(a(0,"small",17),l(1),n()),i&2){let e=m();o(),c(e.controlError("status"))}}function Ue(i,t){if(i&1&&(a(0,"small",17),l(1),n()),i&2){let e=m();o(),c(e.controlError("amount"))}}function Le(i,t){if(i&1&&(a(0,"small",17),l(1),n()),i&2){let e=m(2);o(),c(e.controlError("price"))}}function $e(i,t){if(i&1&&(a(0,"div",1)(1,"label",18),l(2,"Price"),n(),u(3,"p-inputnumber",19),f(4,Le,2,1,"small",4),n()),i&2){let e=m();o(3),s("useGrouping",!1)("min",1e-5)("maxFractionDigits",5)("inputStyle",h(6,De))("invalid",e.isInvalid("price")),o(),s("ngIf",e.isInvalid("price"))}}var Q=class i{constructor(t,e,r,d){this.tradeOrdersService=t;this.messageService=e;this.dialogRef=r;if(this.trade=d?.data?.trade??null,!this.trade){this.messageService.add({severity:"error",summary:"Invalid trade",detail:"Trade data was not provided to edit dialog."}),this.dialogRef?.close({updated:!1});return}this.form.patchValue({pair:this.trade.pair,side:this.trade.side,type:this.trade.type,amount:this.trade.amount,price:this.trade.price,status:this.trade.status}),this.syncPriceControlState(this.typeControl.value),this.typeControl.valueChanges.pipe(N(this.destroy$)).subscribe(p=>{this.syncPriceControlState(p)})}formBuilder=M(K);destroy$=new P;trade;pairOptions=[{label:"BTCUSD - 100150.4",value:"BTCUSD"},{label:"EURUSD - 1.035",value:"EURUSD"},{label:"ETHUSD - 3310",value:"ETHUSD"}];sideOptions=[{label:"BUY",value:"buy"},{label:"SELL",value:"sell"}];typeOptions=[{label:"LIMIT",value:"limit"},{label:"MARKET",value:"market"},{label:"STOP",value:"stop"}];statusOptions=[{label:"OPEN",value:"open"},{label:"CANCELLED",value:"cancelled"},{label:"EXECUTED",value:"executed"}];form=this.formBuilder.group({pair:this.formBuilder.control(null,[v.required]),side:this.formBuilder.control(null,[v.required]),type:this.formBuilder.control(null,[v.required]),amount:this.formBuilder.control(null,[v.required,v.min(.01),Ee(2)]),price:this.formBuilder.control(null),status:this.formBuilder.control(null,[v.required])});submitting=!1;get showPrice(){return this.typeControl.value==="limit"||this.typeControl.value==="stop"}get typeControl(){return this.form.controls.type}get priceControl(){return this.form.controls.price}onSubmit(){if(!this.trade)return;if(this.form.invalid){this.form.markAllAsTouched();return}let t=this.buildPayload();this.submitting=!0,this.tradeOrdersService.updateTradeOrder(this.trade.id,t).pipe(C(()=>this.submitting=!1)).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Trade updated",detail:"Trade order was updated successfully."}),this.dialogRef?.close({updated:!0})},error:e=>this.handleUpdateError(e)})}cancel(){this.dialogRef?.close({updated:!1})}isInvalid(t){let e=this.form.get(t);return!!(e&&e.invalid&&(e.dirty||e.touched))}controlError(t){let e=this.form.get(t);return e?.errors?e.errors.required?"This field is required.":e.errors.min?`Minimum allowed value is ${e.errors.min.min}.`:e.errors.maxDecimals?`Maximum ${e.errors.maxDecimals.required} decimal places are allowed.`:e.errors.backend?String(e.errors.backend):"Invalid value.":""}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}syncPriceControlState(t){if(t==="market"){this.priceControl.setValue(null,{emitEvent:!1}),this.priceControl.clearValidators(),this.priceControl.disable({emitEvent:!1}),this.priceControl.updateValueAndValidity({emitEvent:!1});return}this.priceControl.enable({emitEvent:!1}),this.priceControl.setValidators([v.min(1e-5),Ee(5)]),this.priceControl.updateValueAndValidity({emitEvent:!1})}buildPayload(){let t=this.form.getRawValue(),e=t.type==="market";return{pair:t.pair,side:t.side,type:t.type,amount:Number(t.amount),price:e?null:Number(t.price),status:t.status}}handleUpdateError(t){let e=this.extractMessages(t);if(t.status===400&&this.applyBackendFieldErrors(t.error),e.length===0){this.messageService.add({severity:"error",summary:"Could not update trade",detail:"Unexpected error while updating trade order."});return}e.forEach(r=>{this.messageService.add({severity:"error",summary:"Could not update trade",detail:r})})}extractMessages(t){let e=[],r=t.error;if(typeof r=="string"&&r.trim().length>0)return e.push(r),e;if(r&&typeof r=="object"){Array.isArray(r.message)?r.message.forEach(p=>{typeof p=="string"&&e.push(p)}):typeof r.message=="string"&&e.push(r.message);let d=r.errors;d&&typeof d=="object"&&Object.values(d).forEach(p=>{Array.isArray(p)?p.forEach(b=>{typeof b=="string"&&e.push(b)}):typeof p=="string"&&e.push(p)})}return Array.from(new Set(e))}applyBackendFieldErrors(t){if(!t||typeof t!="object"||!("errors"in t))return;let e=t.errors;!e||typeof e!="object"||Object.entries(e).forEach(([r,d])=>{let p=this.form.get(r);if(!p)return;let b=Array.isArray(d)?String(d[0]??""):String(d??"");p.setErrors(w(D({},p.errors??{}),{backend:b})),p.markAsTouched()})}static \u0275fac=function(e){return new(e||i)(g(S),g(O),g(U,8),g(ge,8))};static \u0275cmp=T({type:i,selectors:[["app-trades-edit"]],standalone:!1,decls:30,vars:26,consts:[[1,"p-fluid","form-grid","grid",3,"ngSubmit","formGroup"],[1,"field","col-12","md:col-6"],["for","pair"],["inputId","pair","formControlName","pair","optionLabel","label","optionValue","value","placeholder","Select pair",1,"w-full",3,"options","invalid","appendTo"],["class","p-error",4,"ngIf"],["for","side"],["inputId","side","formControlName","side","optionLabel","label","optionValue","value","placeholder","Select side",1,"w-full",3,"options","invalid","appendTo"],["for","type"],["inputId","type","formControlName","type","optionLabel","label","optionValue","value","placeholder","Select type",1,"w-full",3,"options","invalid","appendTo"],["for","status"],["inputId","status","formControlName","status","optionLabel","label","optionValue","value","placeholder","Select status",1,"w-full",3,"options","invalid","appendTo"],["for","amount"],["inputId","amount","formControlName","amount","mode","decimal",3,"useGrouping","min","maxFractionDigits","inputStyle","invalid"],["class","field col-12 md:col-6",4,"ngIf"],[1,"col-12","form-actions"],["pButton","","type","button","label","Cancel","severity","secondary","icon","pi pi-times",3,"click"],["pButton","","type","submit","label","Save Changes","icon","pi pi-save",3,"loading"],[1,"p-error"],["for","price"],["inputId","price","formControlName","price","mode","decimal",3,"useGrouping","min","maxFractionDigits","inputStyle","invalid"]],template:function(e,r){e&1&&(a(0,"form",0),y("ngSubmit",function(){return r.onSubmit()}),a(1,"div",1)(2,"label",2),l(3,"Pair"),n(),u(4,"p-select",3),f(5,Ve,2,1,"small",4),n(),a(6,"div",1)(7,"label",5),l(8,"Side"),n(),u(9,"p-select",6),f(10,Be,2,1,"small",4),n(),a(11,"div",1)(12,"label",7),l(13,"Type"),n(),u(14,"p-select",8),f(15,je,2,1,"small",4),n(),a(16,"div",1)(17,"label",9),l(18,"Status"),n(),u(19,"p-select",10),f(20,Fe,2,1,"small",4),n(),a(21,"div",1)(22,"label",11),l(23,"Amount"),n(),u(24,"p-inputnumber",12),f(25,Ue,2,1,"small",4),n(),f(26,$e,5,7,"div",13),a(27,"div",14)(28,"button",15),y("click",function(){return r.cancel()}),n(),u(29,"button",16),n()()),e&2&&(s("formGroup",r.form),o(4),s("options",r.pairOptions)("invalid",r.isInvalid("pair"))("appendTo","body"),o(),s("ngIf",r.isInvalid("pair")),o(4),s("options",r.sideOptions)("invalid",r.isInvalid("side"))("appendTo","body"),o(),s("ngIf",r.isInvalid("side")),o(4),s("options",r.typeOptions)("invalid",r.isInvalid("type"))("appendTo","body"),o(),s("ngIf",r.isInvalid("type")),o(4),s("options",r.statusOptions)("invalid",r.isInvalid("status"))("appendTo","body"),o(),s("ngIf",r.isInvalid("status")),o(4),s("useGrouping",!1)("min",.01)("maxFractionDigits",2)("inputStyle",h(25,De))("invalid",r.isInvalid("amount")),o(),s("ngIf",r.isInvalid("amount")),o(),s("ngIf",r.showPrice),o(3),s("loading",r.submitting))},dependencies:[E,q,$,H,G,z,_,X,Y],styles:[".form-grid[_ngcontent-%COMP%]{margin-top:.5rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.45rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding-top:.75rem}.hint[_ngcontent-%COMP%]{color:var(--text-color-secondary)}"]})};function Ee(i){return t=>{let e=t.value;if(e==null)return null;let r=String(e).split(".")[1]?.length??0;return r>i?{maxDecimals:{required:i,actual:r}}:null}}var Pe=()=>({width:"100%"});function He(i,t){if(i&1&&(a(0,"small",15),l(1),n()),i&2){let e=m();o(),c(e.controlError("pair"))}}function qe(i,t){if(i&1&&(a(0,"small",15),l(1),n()),i&2){let e=m();o(),c(e.controlError("side"))}}function Ge(i,t){if(i&1&&(a(0,"small",15),l(1),n()),i&2){let e=m();o(),c(e.controlError("type"))}}function ze(i,t){if(i&1&&(a(0,"small",15),l(1),n()),i&2){let e=m();o(),c(e.controlError("amount"))}}function Ke(i,t){if(i&1&&(a(0,"small",15),l(1),n()),i&2){let e=m(2);o(),c(e.controlError("price"))}}function Xe(i,t){if(i&1&&(a(0,"div",1)(1,"label",16),l(2,"Price"),n(),u(3,"p-inputnumber",17),f(4,Ke,2,1,"small",4),n()),i&2){let e=m();o(3),s("useGrouping",!1)("min",1e-5)("maxFractionDigits",5)("inputStyle",h(6,Pe))("invalid",e.isInvalid("price")),o(),s("ngIf",e.isInvalid("price"))}}var W=class i{constructor(t,e,r){this.tradeOrdersService=t;this.messageService=e;this.dialogRef=r;this.syncPriceControlState(this.typeControl.value),this.typeControl.valueChanges.pipe(N(this.destroy$)).subscribe(d=>{this.syncPriceControlState(d)})}formBuilder=M(K);pairOptions=[{label:"BTCUSD - 100150.4",value:"BTCUSD"},{label:"EURUSD - 1.035",value:"EURUSD"},{label:"ETHUSD - 3310",value:"ETHUSD"}];sideOptions=[{label:"BUY",value:"buy"},{label:"SELL",value:"sell"}];typeOptions=[{label:"LIMIT",value:"limit"},{label:"MARKET",value:"market"},{label:"STOP",value:"stop"}];form=this.formBuilder.group({pair:this.formBuilder.control("BTCUSD",[v.required]),side:this.formBuilder.control("buy",[v.required]),type:this.formBuilder.control("limit",[v.required]),amount:this.formBuilder.control(null,[v.required,v.min(.01),we(2)]),price:this.formBuilder.control(null)});submitting=!1;destroy$=new P;get showPrice(){return this.typeControl.value==="limit"||this.typeControl.value==="stop"}get typeControl(){return this.form.controls.type}get priceControl(){return this.form.controls.price}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}let t=this.buildPayload();this.submitting=!0,this.tradeOrdersService.createTradeOrder(t).pipe(C(()=>this.submitting=!1)).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Trade created",detail:"Trade order was created successfully."}),this.dialogRef?.close({created:!0})},error:e=>this.handleCreateError(e)})}cancel(){this.dialogRef?.close({created:!1})}isInvalid(t){let e=this.form.get(t);return!!(e&&e.invalid&&(e.dirty||e.touched))}controlError(t){let e=this.form.get(t);return e?.errors?e.errors.required?"This field is required.":e.errors.min?`Minimum allowed value is ${e.errors.min.min}.`:e.errors.maxDecimals?`Maximum ${e.errors.maxDecimals.required} decimal places are allowed.`:e.errors.backend?String(e.errors.backend):"Invalid value.":""}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}syncPriceControlState(t){if(t==="market"){this.priceControl.setValue(null,{emitEvent:!1}),this.priceControl.clearValidators(),this.priceControl.disable({emitEvent:!1}),this.priceControl.updateValueAndValidity({emitEvent:!1});return}this.priceControl.enable({emitEvent:!1}),this.priceControl.setValidators([v.min(1e-5),we(5)]),this.priceControl.updateValueAndValidity({emitEvent:!1})}buildPayload(){let t=this.form.getRawValue(),e=t.type==="market";return{pair:t.pair,side:t.side,type:t.type,amount:Number(t.amount),price:e?null:Number(t.price)}}handleCreateError(t){let e=this.extractMessages(t);if(t.status===400&&this.applyBackendFieldErrors(t.error),e.length===0){this.messageService.add({severity:"error",summary:"Could not create trade",detail:"Unexpected error while creating trade order."});return}e.forEach(r=>{this.messageService.add({severity:"error",summary:"Could not create trade",detail:r})})}extractMessages(t){let e=[],r=t.error;if(typeof r=="string"&&r.trim().length>0)return e.push(r),e;if(r&&typeof r=="object"){Array.isArray(r.message)?r.message.forEach(p=>{typeof p=="string"&&e.push(p)}):typeof r.message=="string"&&e.push(r.message);let d=r.errors;d&&typeof d=="object"&&Object.values(d).forEach(p=>{Array.isArray(p)?p.forEach(b=>{typeof b=="string"&&e.push(b)}):typeof p=="string"&&e.push(p)})}return Array.from(new Set(e))}applyBackendFieldErrors(t){if(!t||typeof t!="object"||!("errors"in t))return;let e=t.errors;!e||typeof e!="object"||Object.entries(e).forEach(([r,d])=>{let p=this.form.get(r);if(!p)return;let b=Array.isArray(d)?String(d[0]??""):String(d??"");p.setErrors(w(D({},p.errors??{}),{backend:b})),p.markAsTouched()})}static \u0275fac=function(e){return new(e||i)(g(S),g(O),g(U,8))};static \u0275cmp=T({type:i,selectors:[["app-trades-new"]],standalone:!1,decls:25,vars:22,consts:[[1,"p-fluid","form-grid","grid",3,"ngSubmit","formGroup"],[1,"field","col-12","md:col-6"],["for","pair"],["inputId","pair","formControlName","pair","optionLabel","label","optionValue","value","placeholder","Select pair",1,"w-full",3,"options","invalid","appendTo"],["class","p-error",4,"ngIf"],["for","side"],["inputId","side","formControlName","side","optionLabel","label","optionValue","value","placeholder","Select side",1,"w-full",3,"options","invalid","appendTo"],["for","type"],["inputId","type","formControlName","type","optionLabel","label","optionValue","value","placeholder","Select type",1,"w-full",3,"options","invalid","appendTo"],["for","amount"],["inputId","amount","formControlName","amount","mode","decimal",3,"useGrouping","min","maxFractionDigits","inputStyle","invalid"],["class","field col-12 md:col-6",4,"ngIf"],[1,"col-12","form-actions"],["pButton","","type","button","label","Cancel","severity","secondary","icon","pi pi-times",3,"click"],["pButton","","type","submit","label","Submit Trade","icon","pi pi-check",3,"loading"],[1,"p-error"],["for","price"],["inputId","price","formControlName","price","mode","decimal",3,"useGrouping","min","maxFractionDigits","inputStyle","invalid"]],template:function(e,r){e&1&&(a(0,"form",0),y("ngSubmit",function(){return r.onSubmit()}),a(1,"div",1)(2,"label",2),l(3,"Pair"),n(),u(4,"p-select",3),f(5,He,2,1,"small",4),n(),a(6,"div",1)(7,"label",5),l(8,"Side"),n(),u(9,"p-select",6),f(10,qe,2,1,"small",4),n(),a(11,"div",1)(12,"label",7),l(13,"Type"),n(),u(14,"p-select",8),f(15,Ge,2,1,"small",4),n(),a(16,"div",1)(17,"label",9),l(18,"Amount"),n(),u(19,"p-inputnumber",10),f(20,ze,2,1,"small",4),n(),f(21,Xe,5,7,"div",11),a(22,"div",12)(23,"button",13),y("click",function(){return r.cancel()}),n(),u(24,"button",14),n()()),e&2&&(s("formGroup",r.form),o(4),s("options",r.pairOptions)("invalid",r.isInvalid("pair"))("appendTo","body"),o(),s("ngIf",r.isInvalid("pair")),o(4),s("options",r.sideOptions)("invalid",r.isInvalid("side"))("appendTo","body"),o(),s("ngIf",r.isInvalid("side")),o(4),s("options",r.typeOptions)("invalid",r.isInvalid("type"))("appendTo","body"),o(),s("ngIf",r.isInvalid("type")),o(4),s("useGrouping",!1)("min",.01)("maxFractionDigits",2)("inputStyle",h(21,Pe))("invalid",r.isInvalid("amount")),o(),s("ngIf",r.isInvalid("amount")),o(),s("ngIf",r.showPrice),o(3),s("loading",r.submitting))},dependencies:[E,q,$,H,G,z,_,X,Y],styles:[".form-grid[_ngcontent-%COMP%]{margin-top:.5rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.45rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding-top:.75rem}.hint[_ngcontent-%COMP%]{color:var(--text-color-secondary)}"]})};function we(i){return t=>{let e=t.value;if(e==null)return null;let r=String(e).split(".")[1]?.length??0;return r>i?{maxDecimals:{required:i,actual:r}}:null}}var Ye=[[["","actions",""]]],Je=["[actions]"];function Qe(i,t){if(i&1&&(a(0,"p",4),l(1),n()),i&2){let e=m();o(),c(e.subtitle)}}var Z=class i{title="";subtitle="";static \u0275fac=function(e){return new(e||i)};static \u0275cmp=T({type:i,selectors:[["app-page-header"]],inputs:{title:"title",subtitle:"subtitle"},standalone:!1,ngContentSelectors:Je,decls:7,vars:2,consts:[[1,"page-header"],[1,"page-title"],["class","page-subtitle",4,"ngIf"],[1,"page-actions"],[1,"page-subtitle"]],template:function(e,r){e&1&&(de(Ye),a(0,"div",0)(1,"div")(2,"h1",1),l(3),n(),f(4,Qe,2,1,"p",2),n(),a(5,"div",3),pe(6),n()()),e&2&&(o(3),c(r.title),o(),s("ngIf",r.subtitle))},dependencies:[E],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap}.page-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:700}.page-subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:var(--text-color-secondary)}.page-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}"]})};var Ze=()=>({"min-width":"72rem"});function et(i,t){i&1&&(a(0,"tr")(1,"th"),l(2,"#"),n(),a(3,"th"),l(4,"Pair"),n(),a(5,"th"),l(6,"Side"),n(),a(7,"th"),l(8,"Type"),n(),a(9,"th"),l(10,"Amount"),n(),a(11,"th"),l(12,"Price"),n(),a(13,"th"),l(14,"Status"),n(),a(15,"th"),l(16,"Action"),n()())}function tt(i,t){if(i&1){let e=ne();a(0,"tr")(1,"td"),l(2),n(),a(3,"td"),l(4),n(),a(5,"td"),u(6,"p-tag",8),I(7,"uppercase"),n(),a(8,"td"),u(9,"p-tag",8),I(10,"uppercase"),n(),a(11,"td"),l(12),I(13,"number"),n(),a(14,"td"),l(15),n(),a(16,"td"),u(17,"p-tag",8),I(18,"uppercase"),n(),a(19,"td")(20,"div",9)(21,"button",10),y("click",function(){let d=A(e).$implicit,p=m();return V(p.openEditTradeDialog(d))}),n(),a(22,"button",11),y("click",function(){let d=A(e).$implicit,p=m();return V(p.deleteTrade(d))}),n()()()()}if(i&2){let e=t.$implicit,r=t.rowIndex,d=m();o(2),c(r+1),o(2),c(e.pair),o(2),s("severity",d.sideSeverity(e.side))("value",j(7,12,e.side)),o(3),s("severity",d.typeSeverity(e.type))("value",j(10,14,e.type)),o(3),c(me(13,16,e.amount,"1.2-2")),o(3),c(d.formatPrice(e.price)),o(2),s("severity",d.statusSeverity(e.status))("value",j(18,19,e.status)),o(5),s("loading",d.deletingTradeId===e.id)("disabled",d.deletingTradeId!==null&&d.deletingTradeId!==e.id)}}function rt(i,t){i&1&&(a(0,"tr")(1,"td",12)(2,"div",13),u(3,"i",14),a(4,"span"),l(5,"No trade orders found."),n()()()())}var ee=class i{constructor(t,e,r){this.tradeOrdersService=t;this.messageService=e;this.dialogService=r}trades=[];loading=!1;deletingTradeId=null;tradeDialogRef=null;ngOnInit(){this.loadTrades()}ngOnDestroy(){this.tradeDialogRef?.close(),this.tradeDialogRef=null}openNewTradeDialog(){this.tradeDialogRef=this.dialogService.open(W,{header:"New Trade",modal:!0,closable:!0,width:"52rem",breakpoints:{"960px":"90vw","640px":"96vw"}}),this.tradeDialogRef?.onClose.pipe(re(1)).subscribe(t=>{t?.created&&this.loadTrades(),this.tradeDialogRef=null})}openEditTradeDialog(t){this.tradeDialogRef=this.dialogService.open(Q,{header:`Edit Trade #${t.id}`,modal:!0,closable:!0,width:"52rem",breakpoints:{"960px":"90vw","640px":"96vw"},data:{trade:t}}),this.tradeDialogRef?.onClose.pipe(re(1)).subscribe(e=>{e?.updated&&this.loadTrades(),this.tradeDialogRef=null})}deleteTrade(t){window.confirm(`Are you sure you want to delete trade #${t.id} (${t.pair})?`)&&(this.deletingTradeId=t.id,this.tradeOrdersService.deleteTradeOrder(t.id).pipe(C(()=>this.deletingTradeId=null)).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Trade deleted",detail:`Trade #${t.id} was deleted successfully.`}),this.loadTrades()},error:r=>{this.messageService.add({severity:"error",summary:"Could not delete trade",detail:this.extractErrorMessage(r)})}}))}loadTrades(){this.loading=!0,this.tradeOrdersService.getTradeOrders().pipe(C(()=>this.loading=!1)).subscribe({next:t=>{this.trades=this.normalizeTradesResponse(t)},error:t=>{this.trades=[],this.messageService.add({severity:"error",summary:"Could not load trades",detail:this.extractErrorMessage(t)})}})}trackByTradeId(t,e){return e.id??t}statusSeverity(t){return{open:"info",cancelled:"warn",executed:"success"}[t]??"info"}sideSeverity(t){return t==="buy"?"success":"danger"}typeSeverity(t){return t==="market"?"warn":"info"}formatPrice(t){return t===null?"-":t.toFixed(5)}normalizeTradesResponse(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"){let e=t,r=[e.data,e.items,e.results].find(Array.isArray);if(Array.isArray(r))return r}return this.messageService.add({severity:"warn",summary:"Unexpected response format",detail:"Trade list response is not an array. Showing empty list."}),[]}extractErrorMessage(t){if(typeof t.error=="string"&&t.error.trim().length>0)return t.error;if(t.error&&typeof t.error=="object"){let e=t.error.message;if(Array.isArray(e)&&e.length>0)return String(e[0]);if(typeof e=="string"&&e.trim().length>0)return e}return"Unexpected error loading trade orders."}static \u0275fac=function(e){return new(e||i)(g(S),g(O),g(L))};static \u0275cmp=T({type:i,selectors:[["app-trades-list"]],standalone:!1,decls:12,vars:7,consts:[["header",""],["body",""],["emptymessage",""],[1,"page-container"],["title","FX Replay - Trade Orders"],["actions",""],["pButton","","type","button","label","New Trade","icon","pi pi-plus","severity","success",3,"click"],[3,"value","loading","rows","paginator","tableStyle","rowTrackBy"],[3,"severity","value"],[1,"action-buttons"],["pButton","","type","button","icon","pi pi-pencil","label","Edit","severity","secondary","size","small",3,"click"],["pButton","","type","button","icon","pi pi-trash","label","Delete","severity","danger","size","small",3,"click","loading","disabled"],["colspan","8",1,"empty-cell"],[1,"empty-state"],[1,"pi","pi-inbox"]],template:function(e,r){if(e&1){let d=ne();a(0,"section",3)(1,"app-page-header",4)(2,"div",5)(3,"button",6),y("click",function(){return A(d),V(r.openNewTradeDialog())}),n()()(),a(4,"p-card")(5,"p-table",7),f(6,et,17,0,"ng-template",null,0,F)(8,tt,23,21,"ng-template",null,1,F)(10,rt,6,0,"ng-template",null,2,F),n()()()}e&2&&(o(5),s("value",r.trades)("loading",r.loading)("rows",10)("paginator",!0)("tableStyle",h(6,Ze))("rowTrackBy",r.trackByTradeId))},dependencies:[_,ye,be,Te,Z,ce,ue],styles:[".empty-cell[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem}.empty-state[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column;gap:.5rem;align-items:center;color:var(--text-color-secondary)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}"]})};var it=[{path:"",component:ee}],te=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=B({type:i});static \u0275inj=k({imports:[ae.forChild(it),ae]})};var Ne=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=B({type:i});static \u0275inj=k({providers:[L],imports:[he,te]})};export{Ne as TradesModule};
